LOG file = /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.APA.notails.stepbystep.log
################################################################################
2023-09-13 16:19:12 initiate scAPAtrap
################################################################################
inputBam = /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam
outputDir = /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep
samtools = /home/dell/miniconda3/envs/scAPA/bin/samtools
umitools = /home/dell/miniconda3/envs/scAPA/bin/umi_tools
featureCounts = /home/dell/miniconda3/envs/scAPA/bin/featureCounts
star = /home/dell/miniconda3/envs/scAPA/bin/STAR
TenX = TRUE
barcode = ACAGAC,ACAGGA,ACAGTG... (96 barcodes)
chrs = 2L,2R,3L,3R,4,X,Y (7 chrs)
maxwidth = 1000
readlength = 49
cov.cutoff = 10
min.cells = 10
min.count = 10
tails.search = no
d = 100
findUniqueMap = TRUE
findUniqueMap.sort = TRUE
findUniqueMap.index = TRUE
thread = 24
>>> 2023-09-13 16:19:29 findUniqueMap: start.
... 2023-09-13 16:19:29 findUniqueMap: /home/dell/miniconda3/envs/scAPA/bin/samtools view -@ 24 -h -F 256 -bS /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam > /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.Uniq.bam
... 2023-09-13 16:19:31 findUniqueMap: command done.
... 2023-09-13 16:19:31 findUniqueMap: /home/dell/miniconda3/envs/scAPA/bin/samtools sort -@ 24 -o /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.bam /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.Uniq.bam
... 2023-09-13 16:19:34 findUniqueMap: command done.
... 2023-09-13 16:19:35 findUniqueMap: /home/dell/miniconda3/envs/scAPA/bin/samtools index -@ 24 /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.bam
... 2023-09-13 16:19:35 findUniqueMap: command done.
>>> 2023-09-13 16:19:35 findUniqueMap: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
inputBam.u='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.bam'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:19:41 dedupByPos: start.
... 2023-09-13 16:19:41 dedupByPos: /home/dell/miniconda3/envs/scAPA/bin/umi_tools dedup -I /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.bam -S /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.bam --method=unique --extract-umi-method=tag --umi-tag=UB --cell-tag=CB
... 2023-09-13 16:20:25 dedupByPos: command done.
>>> 2023-09-13 16:20:25 dedupByPos: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
inputBam.u.dedup='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.bam'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:20:36 separateBamBystrand: start.
... 2023-09-13 16:20:36 separateBamBystrand: /home/dell/miniconda3/envs/scAPA/bin/samtools view -@ 24 -h -F 0x10 -bS /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.bam > /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.forward.bam
... 2023-09-13 16:20:36 separateBamBystrand: command done.
... 2023-09-13 16:20:36 separateBamBystrand: /home/dell/miniconda3/envs/scAPA/bin/samtools view -@ 24 -h -f 0x10 -bS /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.bam > /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.reverse.bam
... 2023-09-13 16:20:37 separateBamBystrand: command done.
... 2023-09-13 16:20:37 separateBamBystrand: /home/dell/miniconda3/envs/scAPA/bin/samtools index -@ 24 /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.forward.bam
... 2023-09-13 16:20:37 separateBamBystrand: command done.
... 2023-09-13 16:20:37 separateBamBystrand: /home/dell/miniconda3/envs/scAPA/bin/samtools index -@ 24 /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.reverse.bam
... 2023-09-13 16:20:37 separateBamBystrand: command done.
>>> 2023-09-13 16:20:37 separateBamBystrand: finish.
>>> 2023-09-13 16:20:52 findPeaksByStrand (+): start.
... 2023-09-13 16:20:52 findPeaksByStrand: loadBpCoverages on 7 chrs: 2L,2R,3L,3R,4,X,Y
... 2023-09-13 16:21:00 findPeaks: start regionMatrix (L=49, cutoff=10)...
... 2023-09-13 16:21:04 findPeaks: chr=Chr2L find 1210 peaks
... 2023-09-13 16:21:04 findPeaks: chr=Chr2R find 2572 peaks
... 2023-09-13 16:21:04 findPeaks: chr=Chr3L find 3867 peaks
... 2023-09-13 16:21:04 findPeaks: chr=Chr3R find 5643 peaks
... 2023-09-13 16:21:04 findPeaks: chr=Chr4 find 5724 peaks
... 2023-09-13 16:21:04 findPeaks: chr=ChrX find 7395 peaks
... 2023-09-13 16:21:04 findPeaks: chr=ChrY find 7418 peaks
... 2023-09-13 16:21:04 findPeaks: 2622 peaks with width>49nt (Read Length) found on all chrs
>>> 2023-09-13 16:21:04 findPeaksByStrand: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
forwardPeaksFile='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.forward.bam.peaks'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:21:04 findPeaksByStrand (-): start.
... 2023-09-13 16:21:04 findPeaksByStrand: loadBpCoverages on 7 chrs: 2L,2R,3L,3R,4,X,Y
... 2023-09-13 16:21:05 findPeaks: start regionMatrix (L=49, cutoff=10)...
... 2023-09-13 16:21:08 findPeaks: chr=Chr2L has 1 peaks with width>1000nt, start splitPeaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr2L split 1 wide peaks to 6 small peaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr2L find 966 peaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr2R find 2344 peaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr3L has 1 peaks with width>1000nt, start splitPeaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr3L split 1 wide peaks to 7 small peaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr3L find 3841 peaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr3R find 5405 peaks
... 2023-09-13 16:21:08 findPeaks: chr=Chr4 find 5652 peaks
... 2023-09-13 16:21:08 findPeaks: chr=ChrX find 7290 peaks
... 2023-09-13 16:21:08 findPeaks: chr=ChrY find 7300 peaks
... 2023-09-13 16:21:08 findPeaks: 2601 peaks with width>49nt (Read Length) found on all chrs
>>> 2023-09-13 16:21:08 findPeaksByStrand: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
reversePeaksFile='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.reverse.bam.peaks'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:21:14 generateSAF: start.
>>> 2023-09-13 16:21:14 generateSAF: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
peaksfile='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/peaks.saf'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:21:24 generateFinalBam: start.
... 2023-09-13 16:21:24 generateFinalBam: /home/dell/miniconda3/envs/scAPA/bin/featureCounts -a /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/peaks.saf -F SAF -t exon -s 1 -M --largestOverlap -o /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/peak_assigned -R BAM -T 24 /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam
... 2023-09-13 16:21:27 generateFinalBam: command done.
... 2023-09-13 16:21:27 generateFinalBam: /home/dell/miniconda3/envs/scAPA/bin/samtools sort -@ 24 /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam.featureCounts.bam -o /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/final.bam && /home/dell/miniconda3/envs/scAPA/bin/samtools index -@ 24 /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/final.bam
... 2023-09-13 16:21:33 generateFinalBam: command done.
>>> 2023-09-13 16:21:33 generateFinalBam: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
final.bam='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/final.bam'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:21:44 countPeaks: start.
... 2023-09-13 16:21:44 countPeaks: /home/dell/miniconda3/envs/scAPA/bin/umi_tools count --per-gene --gene-tag=XT --assigned-status-tag=XS --method=unique --extract-umi-method=tag --umi-tag=UB --cell-tag=CB --per-cell -I /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/final.bam -S /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/counts.tsv.gz
... 2023-09-13 16:22:28 countPeaks: command done.
>>> 2023-09-13 16:22:28 countPeaks: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
countsfile='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/counts.tsv.gz'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:23:29 generatescExpMa: start.
>>> 2023-09-13 16:25:55 generatescExpMa: start.
>>> 2023-09-13 16:27:34 generatescExpMa: start.
... 2023-09-13 16:27:35 generatescExpMa: get peak-cell count matrix.
... 2023-09-13 16:27:35 reducePeaks: 1970 peaks meet min.count (10).
... 2023-09-13 16:27:35 reducePeaks: 1660 peaks meet min.cells (10).
... 2023-09-13 16:27:35 reducePeaks: 1660 peaks (total 5223) meet combined conditions
... 2023-09-13 16:27:35 generatescExpMa: link peaks.meta and peaks.count.
... 2023-09-13 16:27:35 generatescExpMa: peaks.meta=5223 peaks; peaks.counts=1660 peaks; common=1660 peaks.
... 2023-09-13 16:27:35 generatescExpMa: output a list with 1660 peaks.meta (data.frame) and peaks.count (Sparse Matrix).
>>> 2023-09-13 16:27:35 generatescExpMa: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
outputfile='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/scAPAtrapData.rda'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Files marked with * can be savely deleted!
               *findUniqueMap: samtools sort ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.bam
              *findUniqueMap: samtools index ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.bam.bai
                 *dedupByPos: umitools dedup ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.bam
  *separateBamBystrand: samtools forward BAM ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.forward.bam
  *separateBamBystrand: samtools reverse BAM ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.reverse.bam
*separateBamBystrand: samtools forward index ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.forward.bam.bai
*separateBamBystrand: samtools reverse index ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.reverse.bam.bai
                *findPeaksByStrand: peak (+) ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.forward.bam.peaks
                *findPeaksByStrand: peak (-) ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.UniqSorted.dedup.reverse.bam.peaks
                       generateSAF peaks.saf ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/peaks.saf
        *generateFinalBam: featureCounts log ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/peak_assigned
        *generateFinalBam: featureCounts BAM ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam.featureCounts.bam
            *generateFinalBam: samtools sort ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/final.bam
                 countPeaks: umitools counts ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/counts.tsv.gz
              generatescExpMa: scAPAtrapData ==> /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/scAPAtrapData.rda
>>> 2023-09-13 16:28:05 findTails: start.
... 2023-09-13 16:28:34 findTails: save 3355 tails-coords to /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam.genome.tails
>>> 2023-09-13 16:28:34 findTails: finish.
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
tailsfile='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam.genome.tails'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
... 2023-09-13 16:29:06 reducePeaks: 1970 peaks meet min.count (10).
... 2023-09-13 16:29:06 reducePeaks: 1660 peaks meet min.cells (10).
... 2023-09-13 16:29:06 reducePeaks: 1660 peaks (total 5223) meet combined conditions
... 2023-09-13 16:29:06 reducePeaks: save reduced peaksfile to <peaks.saf.reduced> and countsfile to <counts.tsv.gz.reduced>
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
peaksfile.reduced='/mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/APA.notails.stepbystep/peaks.saf.reduced'
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
>>> 2023-09-13 16:29:20 findTailsByPeaks: start.
... 2023-09-13 16:29:20 indexBam: /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam
... 2023-09-13 16:29:24 findTailsByPeaks: findTailsByPeaks on 1213 reduced peak ranges (d=100nt)
... 2023-09-13 16:29:42 findTailsByPeaks: save 1056 tails-coords to /mnt/64cf3476-350c-46ad-bc48-574fa64a0334/test/xwu/demoFly/fly_demo.bam.peaks.tails
>>> 2023-09-13 16:29:42 findTailsByPeaks: finish.
